## 1. 核心参考与对标
- **最高准则**：严格执行本目录下的 `Spec.txt`。所有业务逻辑、字段定义与功能实现必须与之精准对标。
- **规范导向**：严格执行本 `.cursorrules` 定义的技术规范。

## 2. 核心架构逻辑
- **整体模型**：基于 Flutter 双端 App + 后端私有化部署。
- **音视频引擎**：使用 Jitsi Meet 引擎（作为 SDK 调用，不修改核心源码，仅限配置与 UI 品牌化）。
- **准入机制**：必须通过后端签发的 **JWT (JSON Web Token)** 进行房门授权，实现强管控。
- **实时增强**：利用 **Socket.io** 实现增强型即时通讯（心跳监测、在线状态、系统指令下发）。

## 3. 技术栈约束
- **后端**：FastAPI (Python) + PostgreSQL + Redis。
- **移动端**：Flutter (严格排除 x86 架构，仅限 **armv7** 和 **arm64**)。
- **iOS 原生**：必须通过 Swift 实现 `MethodChannel` 桥接，处理隐私权限桥接。
- **i18n (多语言)**：所有客户端（Web/App）与后台管理系统必须集成 i18n 框架。
    - 默认逻辑：跟随用户操作系统语言。
    - 持久化：支持用户手动切换并进行本地/数据库持久化存储。

## 4. 开发阶段性目标（优先级顺序）
1. **第一阶段**：后端基础架构（FastAPI + DB） + JWT 签发逻辑 + 数据库 i18n 配置。
2. **第二阶段**：Web 验证端开发（含合规逻辑校验与 Jitsi IFrame 调用）。
3. **第三阶段**：在后端与 Web 端闭环稳定后，开启移动端硬件审计与 UI 开发。

## 5. 代码风格与安全规范
- **RESTful**：所有接口设计必须符合标准 RESTful 规范。
- **变量安全**：敏感配置（RSA 私钥、Jitsi Secret 等）必须从环境变量加载，**严禁硬编码**。
- **免责合规逻辑**：
    - 所有用户首次进入的页面（登录/注册）必须强制展示《用户须知和免责声明》。
    - 登录页必须包含 `AgreementCheckbox`。
    - **逻辑锁**：登录按钮的激活状态必须由勾选框控制（未勾选则按钮不可点击）。
    - **持久化**：同意状态需关联后端 `agreed_at` 字段记录时间戳。
- **多语言适配**：禁止在代码中硬编码 UI 文本，所有文案必须映射至多语言资源文件。
- **异常处理**：所有关键逻辑需包含错误日志记录与安全性返回码。
- **品牌命名规范**：App 中文名称设定为“和平信使”；除中文外的所有语言版本（如英文等）App 名称一律使用“MOP”。
-**动态 Endpoint 逻辑**：严禁在前端代码中硬编码任何 API 地址。所有请求基地址必须从扫码解析后的 dynamic_endpoint 变量中读取。

-**安全反制意识**：在编写移动端逻辑时，优先实现 SecurityService 进行调试模式检测。

-**双重加密流**：所有敏感数据传输必须在 HTTPS 基础上，额外进行应用层 AES 加密。

## 6. 构建产物与分发
- **不提交安装包**：严禁将 APK、IPA、AAB 等安装包提交到 Git 仓库。安装包仅通过以下方式分发：
    - **构建产物**：CI/CD（如 Codemagic、GitHub Actions）产出的 Artifact 或下载链接。
    - **下载页**：自建下载页（如 `static/apk/download.html`）提供已构建好的安装包链接，安装包文件存放在服务器或对象存储，不纳入版本库。
- 仓库中已用 `.gitignore` 排除 `*.apk`、`*.ipa`、`*.aab` 及 `build_output/`、`builds/`、`static/apk/*.apk` 等路径，提交前请确认未误加入安装包。