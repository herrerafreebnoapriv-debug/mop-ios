# mop-ios 无 Mac 云构建：Flutter 应用在 mobile/ 子目录
name: iOS Build (No Mac)

on:
  push:
    branches: [ main, master ]
  workflow_dispatch:

env:
  FLUTTER_VERSION: '3.24.x'
  MOBILE_DIR: mobile

jobs:
  build-ios:
    runs-on: macos-latest
    timeout-minutes: 60

    steps:
      - name: 检出代码
        uses: actions/checkout@v4

      - name: 配置 Flutter
        uses: subosito/flutter-action@v2
        with:
          flutter-version: ${{ env.FLUTTER_VERSION }}
          channel: 'stable'
          cache: true

      - name: 清理并获取依赖
        working-directory: ${{ env.MOBILE_DIR }}
        run: |
          flutter clean
          flutter pub get

      - name: 构建 iOS IPA（Release）
        working-directory: ${{ env.MOBILE_DIR }}
        run: |
          flutter build ipa --release \
            --build-name=1.0.0 \
            --build-number=${{ github.run_number }} \
            --export-method=app-store

      - name: 上传 IPA 为构建产物
        uses: actions/upload-artifact@v4
        with:
          name: ios-ipa
          path: ${{ env.MOBILE_DIR }}/build/ios/ipa/*.ipa
