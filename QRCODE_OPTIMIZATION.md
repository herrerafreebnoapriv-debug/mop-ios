# 二维码数据结构优化方案

## 当前问题

### 当前数据结构
```json
{
  "api_url": "https://meet.jit.si",
  "room_id": "test-room-1234567890",
  "timestamp": 1768085111
}
```

### 数据长度分析
- **JSON字符串**: 94 字符
- **加密后Base64**: 588 字符
- **二维码版本**: 需要版本15（非常密集，难以扫描）

### 问题根源
1. **字段名过长**: `api_url`, `room_id`, `timestamp` 共23字符
2. **RSA签名固定长度**: RSA-2048签名后Base64编码约344字符（无法优化）
3. **api_url可能固定**: 如果后端配置固定，可以省略

## 优化方案

### 方案1: 使用短键名（推荐）
```json
{
  "u": "https://meet.jit.si",    // url
  "r": "test-room-1234567890",   // room_id
  "t": 1768085111                 // timestamp
}
```
- **JSON字符串**: 74 字符（减少20字符，21.3%）
- **加密后**: 560 字符（减少28字符）
- **二维码版本**: 版本15（仍较密集）

### 方案2: 省略固定api_url（最佳）
如果 `api_url` 在后端配置中固定，可以省略：
```json
{
  "r": "test-room-1234567890",   // room_id
  "t": 1768085111                 // timestamp
}
```
- **JSON字符串**: 46 字符（减少48字符，51.1%）
- **加密后**: 524 字符（减少64字符）
- **二维码版本**: 版本15（仍较密集，但改善明显）

### 方案3: 使用更短的房间ID格式
如果房间ID可以优化：
- 使用UUID短格式（去掉连字符）
- 使用Base62编码的数字ID

## 实施建议

### 推荐方案：方案2（省略固定api_url）

**优点**:
1. 减少数据量最多（64字符，11%）
2. api_url可以从后端配置读取，更安全
3. 二维码更易扫描

**实施步骤**:
1. 修改 `rsa_encrypt()` 函数，支持短键名
2. 修改 `rsa_decrypt()` 函数，支持短键名解析
3. 修改二维码生成逻辑，省略固定api_url
4. 修改二维码验证逻辑，从配置读取api_url

## 二维码版本参考

| 版本 | 最大字符数 (Level H) | 说明 |
|------|---------------------|------|
| 1    | 17                  | 非常小 |
| 5    | 106                 | 小 |
| 10   | 271                 | 中等 |
| 15   | 559                 | 大（当前） |
| 20   | 1006                | 非常大 |

**当前**: 588字符 → 需要版本15+
**优化后**: 524字符 → 仍需要版本15，但密度降低

## 进一步优化建议

如果仍需要更小的二维码：

1. **使用RSA-1024密钥**（不推荐，安全性降低）
2. **使用ECDSA签名**（签名更短，但需要修改加密算法）
3. **使用短URL服务**（将加密数据存储，二维码只包含短URL）
4. **分块二维码**（将数据分成多个二维码）

---

**最后更新**: 2026-01-10
