# 视频通话 UI 讨论：语音/画面分离与「多窗口多人错觉」

## 一、当前架构简述

- **Flutter 层**：`RoomScreen` 负责加入前 loading、加入后状态、结束态。
  - 加入中：全屏「正在加入房间...」
  - 通话中：`JitsiMeet.join()` 后，**Jitsi SDK 全屏覆盖**；按返回触发 `enterPiP()`，Jitsi 进画中画。
  - 最小化后：`RoomScreen` 显示「通话中（已最小化）」+ 提示「点击画中画可恢复…」
  - 结束：用户挂断或会议终止 →「通话已结束」+ 返回按钮。
- **Jitsi 层**：`jitsi_meet_flutter_sdk` 提供**一整块**会议 UI（视频区 + 底部工具栏），我们只传 `configOverrides` / `featureFlags`，**不传** `interfaceConfigOverrides`（SDK 目前也未暴露该参数）。

因此，**同一时刻**用户可能看到：

1. **Jitsi 全屏**：会议界面（视频格 + 工具栏）  
2. **或** Jitsi **画中画** + Flutter 的「通话中（已最小化）」页面  

即：存在 **Flutter 页面** 与 **Jitsi 窗口（全屏 or PiP）** 两套界面。

---

## 二、「语音窗口」和「画面窗口」是否分离？

**从实现上讲，并没有两个独立 App 窗口分别表示「纯语音」和「纯画面」。**

- Jitsi 的会议 UI 是**同一块界面**：中间是视频/头像区域，底部是工具栏（麦克风、摄像头、共享、挂断等）。
- 语音、画面**同屏**：麦克风/扬声器控制与视频格在同一视图里，只是不同区域。

可能造成「分离感」的情况：

- **工具栏 vs 视频区**：底部一大条按钮，容易在视觉上觉得「控制区」和「画面区」是两块。
- **Tile 视图**：每人一大格，自己一格、对方一格，更像「两个画面窗口」并排。
- **Filmstrip（ strip 小窗）**：主画面 + 一侧/底部的一排小头像。若理解成「主画面」+「另一块小画面区」，也会有点像「多窗口」。

所以：**没有真正的语音/画面分离窗口**，但 **布局**（Tile、Filmstrip、工具栏）可能让人产生「多块区域 / 多窗口」的感觉。

---

## 三、「多个窗口」与「多人错觉」从哪来？

### 1. 我们自己的多界面（Flutter + Jitsi）

- 全屏通话时：只有 Jitsi 全屏，Flutter 的 `RoomScreen` 被盖住，用户一般感知不到。
- **最小化后**：同时存在  
  - 画中画（Jitsi 小窗）  
  - Flutter 的「通话中（已最小化）」页  
→ 用户会看到 **两个窗口**：一个 Jitsi、一个我们自己的说明页。  
这容易造成「怎么有两个界面」的困惑，甚至误以为和「多人」有关（尤其是说明文字不醒目时）。

### 2. Jitsi 的多种布局

- **Tile 视图（格栅）**：每人一格，1:1 时就是 2 个大格。看起来像 **两个对等的「画面窗口」**，容易觉得「两个格子 = 两个窗口」。
- **Speaker 视图**：一大格给当前说话者，其它人在 filmstrip 小格。  
  主区域像「一个主窗口」，strip 像「一排小窗口」。
- **Filmstrip**：主画面 + 一排缩略图（通常包含自己 + 对方）。  
  若 strip 里每人一个小头像，会形成 **主窗口 + 多个小窗口** 的既视感。

在 **1:1 通话** 里，若默认用 Tile 或 Filmstrip 较显眼，就会强化「多块区域 / 多窗口」的感觉；再叠加上我们自己的「通话中（已最小化）」页，**多窗口感**更明显。

### 3. 「多人错觉」的可能来源

- **格栅 + strip**：自己一格、对方一格，strip 里又各有一个小头像 → 同一人可能以不同形式出现，容易觉得「人很多」。
- **我们自己的「通话中（已最小化）」页**：若用户没意识到这是「说明页」而非「又一个参会者」，可能加重「怎么这么多人 / 这么多窗口」的错觉。

---

## 四、可考虑的调整方向

### 1. 减轻「多窗口」感（我们侧）

- **最小化时尽量只保留 Jitsi 画中画**  
  - 进入 PiP 后，直接 `pop` 掉 `RoomScreen`，不再显示「通话中（已最小化）」页。  
  - 用户只看到 **一个** 画中画窗口，避免 Flutter 页 + PiP 双窗口。
- **若必须保留说明页**：  
  - 弱化布局（例如半透明 overlay、小横幅），并明确文案是「已最小化，点画中画恢复」，避免被误认为又一个「参会者」或「独立窗口」。

### 2. 优化 Jitsi 布局（服务端 / 配置）

我们目前**不能**在 Flutter SDK 里直接改 `interfaceConfig`，但可以在 **Jitsi 服务端**（如 `interface_config.js`）上做文章：

- **1:1 时更偏 Speaker 视图**：一大格给对方，自己小窗在角落，更接近「单主窗口」的语音/视频通话习惯。
- **弱化或隐藏 Filmstrip**（在 1:1 场景）：  
  - 例如减小 `FILM_STRIP_MAX_HEIGHT`、或从 `TOOLBAR_BUTTONS` 去掉 `filmstrip`，减少「主窗口 + 一排小窗口」的感觉。
- **Tile 视图**：  
  - 若保留，可考虑 1:1 时减少大格数量、或默认不用 Tile，改用 Speaker，降低「两格 = 两窗口」的错觉。

这些需在自建 Jitsi 的 `config.js` / `interface_config.js` 里调，并区分 1:1 / 多人（若后端能传房间类型）则更理想。

### 3. 明确「语音」与「画面」同属一个会议

- 产品文案上强调：**只有一间会议**，麦克风/摄像头控制只是对**这一间**的开关，并非「语音窗口」「画面窗口」两个独立房间。
- UI 上尽量保持 **一块主会议区域 + 一条工具栏**，避免再拆成多块类似「独立窗口」的区块。

### 4. 后续可探索（SDK / 版本支持时）

- 若 `jitsi_meet_flutter_sdk` 后续支持 **interfaceConfigOverrides**（或等价的布局配置），可在 App 内直接：
  - 默认 **Speaker 视图**、**关 Filmstrip**、**关 Tile** 等，进一步收紧「单主窗口」的体验。

---

## 五、小结

| 问题 | 结论 |
|------|------|
| 语音窗口和画面窗口是否分离？ | **没有**单独拆成两个 App 窗口；语音控制在工具栏，画面在中间，同属一块 Jitsi 会议 UI，但布局可能带来「多块区域」的感觉。 |
| 多窗口、多人错觉从哪来？ | （1）我们：最小化时 **Flutter「通话中（已最小化）」+ Jitsi PiP** 两个界面；（2）Jitsi：Tile 双格、Filmstrip 主+ strip 等布局，易像「多窗口」；（3）同一人在主格 + strip 重复出现，可能带来「多人」错觉。 |
| 可先做的 | 最小化时 **只保留 PiP**，不再展示「通话中（已最小化）」页；在 Jitsi 服务端调 **Speaker 优先、弱化/关 Filmstrip**，减轻多窗口感。 |

如需，我可以按「只保留 PiP、pop RoomScreen」的方案，具体列一版 `RoomScreen` / 导航与 PiP 的修改步骤（含边界情况：挂断、异常退出等）。
